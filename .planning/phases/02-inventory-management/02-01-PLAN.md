---
phase: 02-inventory-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/SpoolForm.tsx
  - src/app/spools/new/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can fill in all spool fields (brand, material, color, purchase date, initial weight)"
    - "Color picker shows Bambu Lab palette grouped by category with visual swatches"
    - "Material selector shows base materials and optional modifier"
    - "Initial weight defaults to 1000g"
    - "Form validates required fields and prevents submission with missing data"
    - "Successful submission creates spool and redirects to home page"
  artifacts:
    - path: "src/components/SpoolForm.tsx"
      provides: "Reusable spool form component for both add and edit"
      exports: ["SpoolForm"]
    - path: "src/app/spools/new/page.tsx"
      provides: "Add New Spool page"
  key_links:
    - from: "src/components/SpoolForm.tsx"
      to: "src/actions/spools.ts"
      via: "calls createSpool server action on submit"
      pattern: "createSpool"
    - from: "src/components/SpoolForm.tsx"
      to: "src/lib/colors.ts"
      via: "imports BAMBU_COLOR_PALETTE for color picker"
      pattern: "BAMBU_COLOR_PALETTE"
    - from: "src/components/SpoolForm.tsx"
      to: "src/lib/materials.ts"
      via: "imports BASE_MATERIALS and MATERIAL_MODIFIERS for selectors"
      pattern: "BASE_MATERIALS"
    - from: "src/components/SpoolForm.tsx"
      to: "src/lib/validations.ts"
      via: "uses createSpoolSchema for client-side validation"
      pattern: "createSpoolSchema"
---

<objective>
Build the SpoolForm component and Add New Spool page. The form handles all spool fields with specialized inputs: a visual Bambu Lab color picker with hex swatches, material/modifier dropdowns, brand text input, date picker, and weight input defaulting to 1000g. The form component is designed for reuse in both create and edit flows.

Purpose: This is the primary data entry point for the app -- users need to add spools to build their inventory.
Output: SpoolForm.tsx (reusable) and /spools/new page
</objective>

<execution_context>
@/Users/monkey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/monkey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/actions/spools.ts
@src/lib/validations.ts
@src/lib/colors.ts
@src/lib/materials.ts
@src/db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SpoolForm component with all field inputs</name>
  <files>src/components/SpoolForm.tsx</files>
  <action>
Create a client component ("use client") SpoolForm that accepts optional props for edit mode:
- `initialData?: Partial<Spool>` (pre-fill for edit)
- `onSubmit: (data: CreateSpoolInput) => Promise<ActionResult>` (action to call)
- `submitLabel?: string` (defaults to "Add Spool")

Form fields (all using Tailwind for styling, mobile-responsive):

1. **Brand** - Text input, required. Placeholder "e.g., Bambu Lab, Hatchbox, eSUN"
2. **Material** - Select dropdown populated from BASE_MATERIALS (import from @/lib/materials). Shows material name + description. Required.
3. **Modifier** - Optional select dropdown from MATERIAL_MODIFIERS. First option "None" with empty value. Shows modifier name.
4. **Color** - Two-part picker:
   a. Visual Bambu Lab palette: Import BAMBU_COLOR_PALETTE from @/lib/colors. Render categories as sections with category name headers. Each color is a clickable swatch (small square, ~32x32px) showing the hex color as background. Clicking a swatch sets both colorName and colorHex. Selected swatch gets a visible ring/border.
   b. Below the palette, show current selection: a preview swatch + color name text.
   c. Manual override: two inputs (colorName text input, colorHex input with # prefix) for non-Bambu colors. These sync with palette selection -- clicking palette fills them, typing overrides palette selection.
   d. colorName and colorHex are both required.
5. **Purchase Date** - HTML date input (`type="date"`), optional. Format as ISO string for the server action.
6. **Initial Weight** - Number input, default value 1000 (grams). Show "g" suffix label. Required, must be positive integer.
7. **Price** - Number input, optional. Show "$" prefix label. Step 0.01 for cents.
8. **Notes** - Textarea, optional, max 500 chars. Show character count.

Form behavior:
- Use React useState for form state (NOT useFormState -- keep it simple with useState + server action call)
- On submit: validate with createSpoolSchema.safeParse(), show field-level errors below each input if validation fails, call onSubmit prop if valid
- Show loading state on submit button (disable + "Adding..." text)
- On success: redirect to "/" using next/navigation router.push
- On error (server action returns success:false): show error message at top of form in red alert box
- Style: clean form layout, labels above inputs, consistent spacing (space-y-4 for form groups), full-width inputs on mobile, max-w-2xl container

Do NOT use any form library (react-hook-form, formik) -- plain React state is sufficient for this scope.
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors. Visually inspect that the file imports from the correct paths and exports SpoolForm.
  </verify>
  <done>SpoolForm.tsx exists as a client component with all fields, Bambu Lab color palette picker, validation, loading states, and accepts initialData prop for edit reuse.</done>
</task>

<task type="auto">
  <name>Task 2: Create Add New Spool page</name>
  <files>src/app/spools/new/page.tsx</files>
  <action>
Create the /spools/new route page:

1. Server component that renders SpoolForm in "create" mode
2. Import createSpool from @/actions/spools
3. Pass a wrapper function as onSubmit that calls createSpool
4. Page layout: heading "Add New Spool", back link to "/" (use a simple anchor or Link), then the SpoolForm
5. Style: centered container (max-w-2xl mx-auto), padding for mobile (px-4 py-8)

Note: Since SpoolForm is a client component calling a server action, the onSubmit wrapper needs to be defined inside a client wrapper OR pass createSpool directly (server actions can be passed as props to client components in Next.js 14+). Use the direct approach: pass createSpool as the onSubmit prop since server actions are serializable across the client/server boundary.

Actually, since the form needs to handle the response and redirect, create a thin client wrapper component in the same file or inline: the page itself can be a server component that passes the server action.

Implementation: The page is a server component. It renders SpoolForm and passes createSpool directly as the onSubmit prop. SpoolForm (client component) calls it, handles the response, and redirects on success.
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors. Run `npm run build` to confirm the page route compiles. Navigate to http://localhost:3000/spools/new in browser (via `npm run dev`) and confirm the form renders.
  </verify>
  <done>Navigating to /spools/new shows the spool form with all fields. Submitting with valid data creates a spool and redirects to home page.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. /spools/new page renders the form with all fields
4. Bambu Lab color palette shows colored swatches grouped by category
5. Selecting a color swatch fills colorName and colorHex fields
6. Material dropdown shows all 6 base materials
7. Submitting with empty required fields shows validation errors
8. Submitting with valid data creates a spool (verify via server action) and redirects to /
</verification>

<success_criteria>
- SpoolForm component exists and is reusable (accepts initialData + onSubmit props)
- /spools/new page renders the form
- Form validates required fields client-side before submission
- Initial weight defaults to 1000g
- Color picker shows visual Bambu Lab palette with hex swatches
- Successful form submission creates a spool via createSpool server action
</success_criteria>

<output>
After completion, create `.planning/phases/02-inventory-management/02-01-SUMMARY.md`
</output>

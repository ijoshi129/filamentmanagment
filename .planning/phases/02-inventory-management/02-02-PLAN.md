---
phase: 02-inventory-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/page.tsx
  - src/components/SpoolList.tsx
  - src/components/DeleteSpoolButton.tsx
  - src/app/spools/[id]/edit/page.tsx
autonomous: false

must_haves:
  truths:
    - "Home page shows all spools in the inventory"
    - "Home page has a link/button to add a new spool"
    - "Each spool entry has an edit link that opens the edit form"
    - "Each spool entry has a delete button with confirmation"
    - "Edit form pre-fills all existing spool data"
    - "Edit form saves changes and redirects to home page"
    - "Delete removes the spool and updates the list"
    - "Empty state shows helpful message when no spools exist"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Home page with spool list and add button"
    - path: "src/components/SpoolList.tsx"
      provides: "Spool list display component"
      exports: ["SpoolList"]
    - path: "src/components/DeleteSpoolButton.tsx"
      provides: "Delete button with confirmation dialog"
      exports: ["DeleteSpoolButton"]
    - path: "src/app/spools/[id]/edit/page.tsx"
      provides: "Edit spool page with pre-filled form"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/actions/spools.ts"
      via: "calls getSpools to fetch inventory"
      pattern: "getSpools"
    - from: "src/app/page.tsx"
      to: "src/app/spools/new/page.tsx"
      via: "Link to /spools/new"
      pattern: "spools/new"
    - from: "src/components/DeleteSpoolButton.tsx"
      to: "src/actions/spools.ts"
      via: "calls deleteSpool server action"
      pattern: "deleteSpool"
    - from: "src/app/spools/[id]/edit/page.tsx"
      to: "src/actions/spools.ts"
      via: "calls getSpool to load data, updateSpool to save"
      pattern: "getSpool|updateSpool"
    - from: "src/app/spools/[id]/edit/page.tsx"
      to: "src/components/SpoolForm.tsx"
      via: "renders SpoolForm with initialData"
      pattern: "SpoolForm.*initialData"
---

<objective>
Build the home page spool list with edit and delete functionality. The home page shows all spools (fetched via getSpools server action), provides a prominent "Add Spool" button linking to /spools/new, and each spool entry has edit and delete actions. The edit page reuses SpoolForm from Plan 01 with pre-filled data. Delete uses a confirmation dialog before removing.

Purpose: Completes the CRUD loop -- users can now see, edit, and delete their inventory alongside the add form from Plan 01.
Output: Home page with spool list, delete confirmation, edit page
</objective>

<execution_context>
@/Users/monkey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/monkey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-inventory-management/02-01-SUMMARY.md
@src/actions/spools.ts
@src/lib/validations.ts
@src/lib/materials.ts
@src/db/schema.ts
@src/components/SpoolForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build home page with spool list and delete functionality</name>
  <files>src/app/page.tsx, src/components/SpoolList.tsx, src/components/DeleteSpoolButton.tsx</files>
  <action>
**src/app/page.tsx** - Server component (async):
1. Call getSpools() at the top level (server component can call server actions directly)
2. If result is not success, show error message
3. Layout: heading "Filament Manager", subheading "Track your 3D printing filament inventory", then prominent "Add Spool" button/link to /spools/new (use next/link Link component, styled as a button with Tailwind: bg-blue-600 text-white px-4 py-2 rounded)
4. Below: render SpoolList component passing the spools array
5. Responsive padding: px-4 py-8, max-w-6xl mx-auto

**src/components/SpoolList.tsx** - Client component:
1. Props: `{ spools: Spool[] }` (import Spool type from @/db/schema)
2. If spools array is empty, show empty state: centered message "No spools in your inventory yet" with a link to /spools/new saying "Add your first spool"
3. If spools exist, render a simple list/table showing each spool:
   - Color swatch (small circle or square, 24x24px, background-color from spool.colorHex, with border for light colors)
   - Color name
   - Brand
   - Material (use formatMaterial from @/lib/materials with spool.material and spool.modifier)
   - Initial weight (format as "Xg")
   - Purchase date (show "N/A" if null)
   - Edit link (next/link to `/spools/${spool.id}/edit`)
   - DeleteSpoolButton component
4. Use a responsive layout: on mobile, each spool is a compact row/card. On desktop, a wider row with all info visible.
5. Style with Tailwind: divide-y for row separation, hover:bg-gray-50 for rows, proper spacing

**src/components/DeleteSpoolButton.tsx** - Client component ("use client"):
1. Props: `{ spoolId: string; spoolName: string }` (spoolName for the confirmation message)
2. Renders a red-styled delete button (text "Delete" or trash icon via text)
3. On click: show browser-native confirm() dialog: "Delete {spoolName}? This cannot be undone."
4. If confirmed: call deleteSpool(spoolId) server action, handle loading state (disable button, show "Deleting...")
5. On success: the page auto-refreshes due to revalidatePath('/') in the server action
6. On error: show alert() with error message
7. Use native confirm() -- do NOT build a custom modal (keep it simple, Phase 3 can enhance visuals)
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors. Run `npm run dev`, navigate to http://localhost:3000. With no spools, see empty state. After adding a spool via /spools/new, see it in the list. Click delete, confirm, spool disappears.
  </verify>
  <done>Home page shows spool list (or empty state), has "Add Spool" link, each spool has visible edit link and working delete button with confirmation dialog.</done>
</task>

<task type="auto">
  <name>Task 2: Create Edit Spool page reusing SpoolForm</name>
  <files>src/app/spools/[id]/edit/page.tsx</files>
  <action>
Create the /spools/[id]/edit route page:

1. Server component (async) that receives `params: { id: string }` from Next.js dynamic route
2. Call getSpool(params.id) to load existing spool data
3. If spool not found (success: false), show "Spool not found" message with link back to /
4. If found: render SpoolForm with:
   - `initialData` prop set to the spool's current values (map Spool fields to CreateSpoolInput shape -- brand, material, modifier, colorName, colorHex, status, initialWeight, purchaseDate, price, notes)
   - `onSubmit` prop: pass a function that calls updateSpool(id, data). Since this is a server component rendering a client component, create a bound server action: define an inline server action using "use server" that wraps updateSpool with the spool ID pre-bound.
   - `submitLabel="Save Changes"`
5. Page layout: heading "Edit Spool", back link to "/" (Link component), then the SpoolForm
6. Style: same as add page -- max-w-2xl mx-auto, px-4 py-8

Important implementation detail for passing the server action:
```tsx
async function handleUpdate(data: CreateSpoolInput) {
  "use server";
  return updateSpool(id, data);
}
```
This creates a closure over `id` and can be passed to the client component.
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors. Add a spool via /spools/new, then click Edit on the home page list. Verify the edit form is pre-filled with existing data. Change a field, submit, verify the change persists on the home page.
  </verify>
  <done>Navigating to /spools/[id]/edit shows the SpoolForm pre-filled with existing spool data. Submitting changes updates the spool and redirects to home page with updated data visible.</done>
</task>

<task type="auto">
  <name>Task 3: Verify complete inventory management flow</name>
  <files>src/app/page.tsx</files>
  <action>
This is a human-verify checkpoint. Present the following verification steps to the user and pause for approval.

What was built: Complete inventory management flow -- add spool form with Bambu Lab color picker, spool list on home page, edit form with pre-filled data, delete with confirmation.

Verification steps for the user:
1. Run `npm run dev` and open http://localhost:3000
2. Verify empty state message shows when no spools exist
3. Click "Add Spool" -- should navigate to /spools/new
4. Fill in the form: type "Bambu Lab" for brand, select "PLA" material, click a color swatch from the Bambu palette (verify it fills color name and hex), leave weight at 1000g default, submit the form
5. Verify redirect to home page with the new spool visible in the list
6. Click "Edit" on the spool -- verify form pre-fills with all saved data
7. Change the brand to "Hatchbox", submit -- verify change shows on home page
8. Click "Delete" -- verify confirmation dialog appears
9. Confirm delete -- verify spool disappears from list
10. Verify mobile responsiveness: resize browser to phone width, check forms and list are usable

Resume signal: Type "approved" or describe any issues to fix.
  </action>
  <verify>User confirms the full CRUD flow works correctly by testing all 10 verification steps.</verify>
  <done>User has approved the complete inventory management flow or issues have been identified for fixing.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. Home page at / shows spool list or empty state
4. "Add Spool" link navigates to /spools/new
5. Adding a spool populates the home page list
6. Edit link opens /spools/[id]/edit with pre-filled SpoolForm
7. Saving edits updates the spool data
8. Delete button shows confirmation and removes spool on confirm
9. All forms are mobile-responsive
</verification>

<success_criteria>
- User can add a spool via /spools/new with all fields (INV-01)
- User can edit any spool field via /spools/[id]/edit (INV-02)
- User can delete a spool with confirmation dialog (INV-03)
- Home page displays all spools with color swatches, material, brand
- Empty state shows when no spools exist
- Forms validate required fields before submission
- Initial weight defaults to 1000g
</success_criteria>

<output>
After completion, create `.planning/phases/02-inventory-management/02-02-SUMMARY.md`
</output>

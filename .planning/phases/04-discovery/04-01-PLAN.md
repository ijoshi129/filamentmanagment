---
phase: 04-discovery
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/components/SpoolList.tsx]
autonomous: true

must_haves:
  truths:
    - "User can type text in a search bar and see only spools matching brand, material, or color name"
    - "User can select multiple materials to filter by (e.g. PLA + PETG simultaneously)"
    - "User can select multiple brands to filter by (e.g. Bambu Lab + Hatchbox simultaneously)"
    - "Search text and multi-select filters combine together (intersection logic)"
    - "Active filters and search text persist while navigating within the session"
  artifacts:
    - path: "src/components/SpoolList.tsx"
      provides: "Search bar, multi-select filter chips, combined filter+search pipeline"
      contains: "searchQuery"
  key_links:
    - from: "search input onChange"
      to: "filtered useMemo"
      via: "searchQuery state drives text matching in filter pipeline"
      pattern: "searchQuery.*toLowerCase"
    - from: "multi-select filter state"
      to: "filtered useMemo"
      via: "Set-based inclusion check replaces single-value equality"
      pattern: "filters\\..*\\.size.*===.*0|filters\\..*\\.has"
---

<objective>
Add text search and multi-select filtering to the spool inventory so users can quickly find specific spools by typing or narrowing by material/brand.

Purpose: This is the final phase — completing the core value of "quickly see what filament you have." Users with 20+ spools need search and multi-select filters to find what they need without scrolling.

Output: Enhanced SpoolList.tsx with search bar, multi-select filter chips replacing single-select dropdowns, and combined filter+search logic.
</objective>

<execution_context>
@/Users/monkey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/monkey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/SpoolList.tsx
@src/db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add text search bar with real-time filtering</name>
  <files>src/components/SpoolList.tsx</files>
  <action>
Add a search input to SpoolList.tsx that filters spools by matching text against brand, material, modifier, and colorName fields.

1. Add `searchQuery` state: `const [searchQuery, setSearchQuery] = useState("")`

2. Add search input in the toolbar area (before the Filters button). Style it as:
   - Full-width text input with search icon (magnifying glass SVG inline, same style as existing SVG icons)
   - Placeholder text: "Search by color, brand, or material..."
   - Rounded corners matching existing UI (borderRadius 10px)
   - Border: 1px solid #d1d5db, focus border: #3b82f6
   - Padding: 8px 12px 8px 36px (left padding for search icon)
   - Place above the filter/sort toolbar row, full width

3. Integrate search into the existing `filtered` useMemo:
   - After existing filter checks, add text search:
   ```
   if (searchQuery.trim()) {
     const q = searchQuery.toLowerCase();
     const matchesSearch = [s.brand, s.material, s.modifier, s.colorName]
       .some(field => field?.toLowerCase().includes(q));
     if (!matchesSearch) return false;
   }
   ```
   - Add `searchQuery` to the useMemo dependency array

4. Update the "no results" empty state to mention search:
   - Change text to "No spools match your search or filters" when searchQuery is non-empty
   - Add a "Clear search" action alongside existing "Clear filters" button
   - The clearFilters function should also clear searchQuery

5. Update the count display to reflect search: "{filtered.length} of {spools.length} spools" already works since filtered includes search.
  </action>
  <verify>
Run `npx next build` — no TypeScript errors. Visually: search bar appears above filter toolbar, typing text filters cards in real-time, clearing search shows all spools again.
  </verify>
  <done>
Text search input filters spools by brand, material, modifier, and color name. Search combines with existing dropdown filters. Empty results show appropriate message with clear action.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert single-select filter dropdowns to multi-select toggle chips</name>
  <files>src/components/SpoolList.tsx</files>
  <action>
Replace the single-select dropdown filters with multi-select toggle chip buttons so users can select multiple values simultaneously.

1. Change the Filters type from string values to Set values:
   ```typescript
   type Filters = {
     status: Set<string>;
     brand: Set<string>;
     material: Set<string>;
     modifier: Set<string>;
   };
   ```
   Initialize all as empty Sets (empty = "all", no filter applied).

2. Replace the `updateFilter` function with a `toggleFilter` function:
   ```typescript
   const toggleFilter = (key: keyof Filters, value: string) => {
     setFilters(prev => {
       const newSet = new Set(prev[key]);
       if (newSet.has(value)) {
         newSet.delete(value);
       } else {
         newSet.add(value);
       }
       return { ...prev, [key]: newSet };
     });
   };
   ```

3. Update `clearFilters` to reset all to empty Sets. Also clear searchQuery.

4. Update `activeFilterCount` to count Sets with size > 0:
   ```typescript
   const activeFilterCount = Object.values(filters).filter(s => s.size > 0).length;
   ```

5. Update the `filtered` useMemo logic — for each filter, skip if Set is empty (means "all"), otherwise check if value is in the Set:
   ```typescript
   if (filters.status.size > 0 && !filters.status.has(s.status)) return false;
   if (filters.brand.size > 0 && !filters.brand.has(s.brand)) return false;
   if (filters.material.size > 0 && !filters.material.has(s.material)) return false;
   if (filters.modifier.size > 0 && !filters.modifier.has(s.modifier || "")) return false;
   ```

6. Replace filter panel `<select>` dropdowns with toggle chip buttons for each category. For each filter group (Status, Brand, Material, Type):
   - Render a row of small pill/chip buttons for each unique value
   - Selected chips: bg-blue-600 text-white
   - Unselected chips: bg-white border border-gray-300 text-gray-700 hover:bg-gray-50
   - Chip style: padding 4px 12px, borderRadius 999px (pill shape), fontSize 13px, cursor pointer, transition colors
   - onClick calls toggleFilter(key, value)
   - Keep the same category labels (STATUS, BRAND, MATERIAL, TYPE) with same uppercase styling

7. For the status chips, display friendly names: "sealed" → "Sealed", "in_use" → "Open", "empty" → "Empty". For brand/material/modifier, use the same display logic as existing dropdowns (material.toUpperCase(), modifier capitalize).
  </action>
  <verify>
Run `npx next build` — no TypeScript errors. Visually: filter panel shows toggle chips instead of dropdowns. Multiple chips can be selected simultaneously (e.g. PLA + PETG). Selecting chips filters the card grid. Combined with search, both constraints apply.
  </verify>
  <done>
Filter dropdowns replaced with multi-select toggle chips. Users can select multiple materials, brands, statuses, and modifiers simultaneously. Chips visually indicate selected state. Filters combine with text search using intersection logic. Clearing filters resets all chips and search.
  </done>
</task>

</tasks>

<verification>
1. `npx next build` passes with no errors
2. Search bar appears and filters cards by brand, material, modifier, and color name in real-time
3. Filter panel shows toggle chips (not dropdowns) for each category
4. Multiple chips can be selected per category (e.g. PLA + PETG)
5. Search and multi-select filters combine (intersection — both must match)
6. "Clear all" resets both filters and search
7. Empty/no-results state shows appropriate message for search vs filter
8. Count display updates correctly: "X of Y spools"
9. Filter/search state persists while component is mounted (stays during session)
</verification>

<success_criteria>
- User can search by typing text that matches across brand, material, and color name
- User can filter by multiple materials simultaneously using chip toggles
- User can filter by multiple brands simultaneously using chip toggles
- Search + filters combine (both constraints apply)
- State persists during the session (React state maintained while component mounted)
- All Phase 4 success criteria from ROADMAP.md are met
</success_criteria>

<output>
After completion, create `.planning/phases/04-discovery/04-01-SUMMARY.md`
</output>

---
phase: 03-visual-display
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/SpoolList.tsx
  - src/components/SpoolCard.tsx
autonomous: true

must_haves:
  truths:
    - "User can sort spools by color family, most recent, oldest, or material"
    - "Sort dropdown is visible above the card grid and persists selection"
    - "Empty inventory shows a friendly illustration with 'Add your first spool' CTA"
    - "Filtered view with zero results shows 'No spools match your filters' with a Clear filters button"
    - "Cards hide fields that have no data instead of showing placeholders"
  artifacts:
    - path: "src/components/SpoolList.tsx"
      provides: "Sort dropdown, enhanced empty state, distinct no-results state"
      contains: "sortOption"
    - path: "src/components/SpoolCard.tsx"
      provides: "Conditional field rendering for missing data"
      contains: "spool.purchaseDate"
  key_links:
    - from: "src/components/SpoolList.tsx"
      to: "sort state"
      via: "useState for sortOption, useMemo for sorted array"
      pattern: "sortOption|setSortOption"
    - from: "src/components/SpoolList.tsx"
      to: "empty states"
      via: "spools.length === 0 vs filtered.length === 0"
      pattern: "No spools match"
---

<objective>
Add sort controls, polished empty states, and missing-data handling to the spool inventory view.

Purpose: Users need to organize their spool grid by different criteria (color, date, material) and see helpful feedback when the inventory is empty or filters match nothing. Cards should only show fields that have data, keeping the display clean.

Output: Sort dropdown in SpoolList, enhanced empty/no-results states, conditional field rendering in SpoolCard.
</objective>

<execution_context>
@/Users/monkey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/monkey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/SpoolList.tsx
@src/components/SpoolCard.tsx
@src/db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sort dropdown and missing-data handling</name>
  <files>src/components/SpoolList.tsx, src/components/SpoolCard.tsx</files>
  <action>
**SpoolList.tsx -- Sort dropdown:**

1. Add sort state: `const [sortOption, setSortOption] = useState<string>("most-recent")` with options:
   - `"most-recent"` -- sort by createdAt descending (newest first) -- DEFAULT
   - `"oldest"` -- sort by createdAt ascending
   - `"by-material"` -- sort by material name alphabetically, then by colorName
   - `"by-color-family"` -- sort by colorHex (this groups similar hues together since hex sorts roughly by hue for many palettes), then by colorName
   - `"by-brand"` -- sort by brand alphabetically, then by colorName

2. Add a `useMemo` that sorts `filtered` based on `sortOption`. Call it `sorted`. Use `sorted` instead of `filtered` in the grid rendering. Sorting logic:
   - `"most-recent"`: `b.createdAt.localeCompare(a.createdAt)` (desc)
   - `"oldest"`: `a.createdAt.localeCompare(b.createdAt)` (asc)
   - `"by-material"`: `a.material.localeCompare(b.material) || a.colorName.localeCompare(b.colorName)`
   - `"by-color-family"`: `a.colorHex.localeCompare(b.colorHex) || a.colorName.localeCompare(b.colorName)`
   - `"by-brand"`: `a.brand.localeCompare(b.brand) || a.colorName.localeCompare(b.colorName)`

3. Render the sort dropdown in the toolbar row (the existing `flex items-center gap-3 mb-4` div), placed between the Filters button area and the count display (`ml-auto`). Use a `<select>` element styled consistently with the filter panel selects (same selectStyle or a similar inline-style approach). Label it with a small "Sort by" prefix or just have the select with descriptive option text:
   - "Most Recent"
   - "Oldest First"
   - "By Material"
   - "By Color Family"
   - "By Brand"

**SpoolCard.tsx -- Missing data handling:**

4. In SpoolCard, make the detail row (status, weight, purchase date) conditional per field:
   - Always show the status pill (status always has a value)
   - Only show weight (`{spool.initialWeight}g`) if `spool.initialWeight` is truthy (it has a default of 1000 so it usually will be, but handle gracefully)
   - Only show purchase date if `spool.purchaseDate` is truthy (this is already partially done with `{spool.purchaseDate && ...}` but ensure the gap spacing doesn't leave awkward empty space)
   - Only show price if it were displayed (currently not displayed, so no change needed)
   - The key principle: if a field has no data, its DOM element should not render at all. Cards may vary in height and that is fine per user decision.
  </action>
  <verify>
Run `npx next build` from project root -- build succeeds with no TypeScript errors. Run `npx next dev` and confirm: sort dropdown appears in toolbar, changing sort reorders cards, cards with missing purchaseDate do not show an empty gap.
  </verify>
  <done>
Sort dropdown with 5 options is visible and functional. Default sort is "Most Recent". Cards hide fields that have no data rather than showing placeholders. Cards may vary in height.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhanced empty state and distinct no-results state</name>
  <files>src/components/SpoolList.tsx</files>
  <action>
**Empty inventory state (spools.length === 0):**

1. Replace the current basic empty state with a friendlier illustration-based design:
   - Create an inline SVG illustration of a simple spool/shelf scene (keep it simple -- a stylized spool icon or a shelf with empty spots). Use a muted color palette (grays, light blue accent). The illustration should be roughly 120-160px wide/tall.
   - Alternatively, use a larger emoji composition if SVG is too complex -- e.g., a 80px container with a spool emoji at larger size, or compose a simple scene with CSS shapes (rounded rectangle "shelf" with small circles as "spools").
   - Below the illustration: heading "Your filament shelf is empty" (text-lg font-semibold text-gray-700)
   - Subtext: "Add your first spool to start tracking your collection" (text-sm text-gray-500)
   - CTA button: "Add Your First Spool" linking to /spools/new, styled as primary button (bg-blue-600 text-white px-6 py-2.5 rounded-lg font-medium hover:bg-blue-700). Keep the existing Link approach.
   - Wrap everything in a centered container with generous vertical padding (py-20).

**No-results state (spools.length > 0 but filtered.length === 0):**

2. Replace the current minimal "No spools match your filters" text with a more helpful design:
   - A small search/filter icon (inline SVG, ~40px, gray) above the text
   - Text: "No spools match your filters" (text-base font-medium text-gray-600)
   - Subtext: "Try adjusting your filters or clear them to see all spools" (text-sm text-gray-400)
   - "Clear filters" button below: styled as a secondary action (text-blue-600 font-medium text-sm, underline or button style). Wire it to the existing `clearFilters` function.
   - Center everything, give it vertical padding (py-12).
   - IMPORTANT: Also hide the sort dropdown when there are no results (or keep it visible but the key thing is the Clear filters button must be prominent and functional).
  </action>
  <verify>
Run `npx next build` -- build succeeds. Test both states:
1. Delete all spools (or test with empty DB) -- should see illustration + "Add Your First Spool" CTA
2. With spools present, apply filters that match nothing -- should see "No spools match your filters" with working "Clear filters" button
  </verify>
  <done>
Empty inventory shows friendly illustration with "Add Your First Spool" CTA button linking to /spools/new. Filtered no-results shows "No spools match your filters" with a functional "Clear filters" button that resets all filters. Both states are visually polished with appropriate icons/illustrations.
  </done>
</task>

</tasks>

<verification>
- `npx next build` completes without errors
- Sort dropdown appears in toolbar with 5 sort options
- Changing sort option reorders cards immediately
- Default sort is "Most Recent" (newest first)
- Cards with missing purchaseDate do not render that field
- Empty inventory (0 spools) shows illustration + "Add Your First Spool" CTA
- Filtered no-results shows "No spools match your filters" + working "Clear filters" button
- Clear filters button resets all filter dropdowns to "All"
</verification>

<success_criteria>
- Sort dropdown functional with all 5 options (most recent, oldest, by material, by color family, by brand)
- Empty state has illustration and prominent "Add Your First Spool" CTA
- No-results state clearly distinguishable from empty state, with "Clear filters" action
- Cards gracefully hide missing data fields (no empty gaps or placeholder text)
</success_criteria>

<output>
After completion, create `.planning/phases/03-visual-display/03-02-SUMMARY.md`
</output>

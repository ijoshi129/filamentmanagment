---
phase: 01-data-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - drizzle.config.ts
  - src/lib/db.ts
  - src/db/schema.ts
  - .env.local
  - src/app/layout.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Next.js dev server starts and renders a page at localhost:3000"
    - "Drizzle is configured with SQLite and can connect to a local database file"
    - "Spool table exists with all required fields including brand, material, modifier, color_name, color_hex, purchase_date, initial_weight, status, notes, and price"
    - "Database migration runs successfully creating the spool table"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies including next, react, drizzle-orm, better-sqlite3"
    - path: "src/db/schema.ts"
      provides: "Drizzle schema with spools table definition"
      contains: "spools"
    - path: "src/lib/db.ts"
      provides: "Database connection singleton"
      contains: "drizzle"
    - path: "drizzle.config.ts"
      provides: "Drizzle Kit configuration for migrations"
  key_links:
    - from: "src/lib/db.ts"
      to: "src/db/schema.ts"
      via: "schema import"
      pattern: "import.*schema"
    - from: "drizzle.config.ts"
      to: "src/db/schema.ts"
      via: "schema path reference"
      pattern: "schema.*src/db/schema"
---

<objective>
Bootstrap the Next.js project with Drizzle ORM and SQLite, then define and migrate the spool database schema.

Purpose: Establishes the entire project foundation -- runtime, database, and schema -- so all subsequent plans have a working project to build on.
Output: Running Next.js app with SQLite database containing the spools table.
</objective>

<execution_context>
@/Users/monkey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/monkey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-data-foundation/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bootstrap Next.js project with Drizzle and SQLite</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    drizzle.config.ts
    src/lib/db.ts
    .env.local
    src/app/layout.tsx
    src/app/page.tsx
  </files>
  <action>
    Run `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --use-npm` in the project root (answer yes to overwrite if prompted, use default turbopack option).

    Install database dependencies: `npm install drizzle-orm better-sqlite3` and `npm install -D drizzle-kit @types/better-sqlite3`.

    Create `.env.local` with `DATABASE_URL=sqlite.db`.

    Create `drizzle.config.ts`:
    - dialect: "sqlite"
    - schema: "./src/db/schema.ts"
    - out: "./drizzle"
    - dbCredentials.url: process.env.DATABASE_URL or "sqlite.db"

    Create `src/lib/db.ts`:
    - Import drizzle from "drizzle-orm/better-sqlite3"
    - Import Database from "better-sqlite3"
    - Create a singleton database connection using the DATABASE_URL env var (default "sqlite.db")
    - Export the drizzle instance and the raw sqlite connection

    Update `src/app/page.tsx` to render a simple "Filament Manager" heading (placeholder).

    Add "sqlite.db" and "sqlite.db-*" to .gitignore.
  </action>
  <verify>
    Run `npm run dev` briefly (start and kill after confirming compilation). Verify no TypeScript errors with `npx tsc --noEmit`. Confirm `src/lib/db.ts` and `drizzle.config.ts` exist.
  </verify>
  <done>Next.js dev server compiles without errors. Drizzle config points to schema file. Database connection module exports drizzle instance.</done>
</task>

<task type="auto">
  <name>Task 2: Define spool schema and run initial migration</name>
  <files>
    src/db/schema.ts
  </files>
  <action>
    Create `src/db/schema.ts` with a `spools` table using Drizzle's SQLite schema builder:

    Fields (use sqliteTable):
    - id: text primary key (use crypto.randomUUID or nanoid pattern -- generate via $defaultFn)
    - brand: text, not null (e.g., "Bambu Lab", "Hatchbox")
    - material: text, not null (e.g., "PLA", "PETG")
    - modifier: text, nullable (e.g., "Silk", "Carbon Fiber", "Matte")
    - colorName: text("color_name"), not null (e.g., "Bambu Green", "Custom Red")
    - colorHex: text("color_hex"), not null (e.g., "#00AE42")
    - status: text, not null, default "sealed" (values: "sealed", "in_use", "empty")
    - initialWeight: integer("initial_weight"), not null, default 1000 (grams)
    - purchaseDate: text("purchase_date"), nullable (ISO date string)
    - price: real, nullable (cost per spool)
    - notes: text, nullable
    - createdAt: text("created_at"), not null, default sql`(datetime('now'))`
    - updatedAt: text("updated_at"), not null, default sql`(datetime('now'))`

    Export the table definition AND infer TypeScript types:
    - `export type Spool = typeof spools.$inferSelect`
    - `export type NewSpool = typeof spools.$inferInsert`

    Run migration: `npx drizzle-kit push` to push schema to SQLite database.

    Verify the table was created by writing a small inline check: run `npx drizzle-kit studio` briefly or use a quick node script to confirm the table exists (SELECT name FROM sqlite_master WHERE type='table' AND name='spools').
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm schema types compile. Run `npx drizzle-kit push` (should report no changes if already pushed, confirming schema is in sync). Verify sqlite.db file exists in project root.
  </verify>
  <done>spools table exists in SQLite with all 13 fields. Spool and NewSpool types are exported and usable. `drizzle-kit push` reports schema is in sync.</done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. `npx tsc --noEmit` passes
3. sqlite.db file exists in project root
4. spools table has correct columns (id, brand, material, modifier, color_name, color_hex, status, initial_weight, purchase_date, price, notes, created_at, updated_at)
5. TypeScript types Spool and NewSpool are importable from src/db/schema
</verification>

<success_criteria>
- Next.js project runs at localhost:3000
- Drizzle ORM connects to SQLite database
- Spools table schema matches all fields from CONTEXT.md decisions
- TypeScript compilation clean with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-data-foundation/01-01-SUMMARY.md`
</output>
